name: Build and Release Desktop App

on:
  push:
    tags:
      - 'v*'  # Triggers on version tags like v1.0.0

jobs:
  release:
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [windows-latest, macos-latest, ubuntu-latest]
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: npm install
      
      - name: Build Electron app (Windows)
        if: matrix.os == 'windows-latest'
        run: npm run electron:build:win
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Build Electron app (macOS)
        if: matrix.os == 'macos-latest'
        run: npm run electron:build:mac
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Build Electron app (Linux)
        if: matrix.os == 'ubuntu-latest'
        run: npm run electron:build:linux
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Upload artifacts (Windows)
        if: matrix.os == 'windows-latest'
        uses: actions/upload-artifact@v4
        with:
          name: windows-installer
          path: dist-electron/*.exe
      
      - name: Upload artifacts (macOS)
        if: matrix.os == 'macos-latest'
        uses: actions/upload-artifact@v4
        with:
          name: macos-installer
          path: dist-electron/*.dmg
      
      - name: Upload artifacts (Linux)
        if: matrix.os == 'ubuntu-latest'
        uses: actions/upload-artifact@v4
        with:
          name: linux-installer
          path: |
            dist-electron/*.AppImage
            dist-electron/*.deb

  publish:
    needs: release
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Download Windows artifact
        uses: actions/download-artifact@v4
        with:
          name: windows-installer
          path: ./artifacts/windows
      
      - name: Download macOS artifact
        uses: actions/download-artifact@v4
        with:
          name: macos-installer
          path: ./artifacts/macos
      
      - name: Download Linux artifact
        uses: actions/download-artifact@v4
        with:
          name: linux-installer
          path: ./artifacts/linux
      
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            artifacts/windows/*.exe
            artifacts/macos/*.dmg
            artifacts/linux/*.AppImage
            artifacts/linux/*.deb
          draft: false
          prerelease: false
          generate_release_notes: true
          body: |
            # K8s Platform Manager Desktop App ğŸš€
            
            ## Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ…â€ŒØ¹Ø§Ù…Ù„ Ø®ÙˆØ¯:
            
            ### ğŸªŸ Windows
            - ÙØ§ÛŒÙ„ `.exe` Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
            - Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯ Ùˆ Ù…Ø±Ø§Ø­Ù„ Ù†ØµØ¨ Ø±Ø§ Ø·ÛŒ Ú©Ù†ÛŒØ¯
            - Ø§Ø² Ù…Ù†ÙˆÛŒ Start Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø§Ø² Ø¯Ø³Ú©ØªØ§Ù¾
            
            ### ğŸ macOS
            - ÙØ§ÛŒÙ„ `.dmg` Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯
            - Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ù‡ Applications Ø¨Ú©Ø´ÛŒØ¯
            - Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯
            
            ### ğŸ§ Linux
            - **AppImage**: Ø¯Ø§Ù†Ù„ÙˆØ¯ â†’ Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø¬Ø±Ø§ â†’ Ø¯ÙˆØ¨Ø§Ø± Ú©Ù„ÛŒÚ©
              ```bash
              chmod +x K8s-Platform-Manager-*.AppImage
              ./K8s-Platform-Manager-*.AppImage
              ```
            - **DEB**: Ø¨Ø±Ø§ÛŒ Ubuntu/Debian
              ```bash
              sudo dpkg -i k8s-platform-manager_*.deb
              ```
            
            ## ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:
            âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ API Ù…Ø¯ÛŒØ±ÛŒØª Kubernetes  
            âœ… Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù„Ø§Ø³ØªØ±Ù‡Ø§  
            âœ… Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†â€ŒÙ‡Ø§ Ø¨Ø§ ÛŒÚ© Ú©Ù„ÛŒÚ©  
            âœ… Ù†Ù…Ø§ÛŒØ´ Ø®ÙˆØ¯Ú©Ø§Ø± username Ùˆ password Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§  
            âœ… Ú©Ù†ØªØ±Ù„ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ (Restart, Stop, Start, Delete)  
            âœ… Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ ÛŒÚ© Ú©Ù„ÛŒÚ©  
            âœ… Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø±  
            âœ… System Tray Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹  
            
            ## Ù…Ø³ØªÙ†Ø¯Ø§Øª:
            - [Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù†ØµØ¨ Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡](https://github.com/YOUR_USERNAME/k8s-platform-panel/blob/main/DESKTOP-APP.md)
            - [Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ø¬Ø±Ø§](https://github.com/YOUR_USERNAME/k8s-platform-panel/blob/main/HOW-TO-RUN.md)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
